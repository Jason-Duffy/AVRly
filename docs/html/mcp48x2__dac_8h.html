<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AVRly - AVR Development Resources: content/modules/data-converters/mcp48x2_dac/example/mcp48x2_dac.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">AVRly - AVR Development Resources
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('mcp48x2__dac_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">mcp48x2_dac.h File Reference<div class="ingroups"><a class="el" href="group__data__converters.html">Data Converters</a> &raquo; <a class="el" href="group__mcp48x2.html">MCP48x2 DAC</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Driver for the MCP4812 10 bit DAC (digital to analog converter) chip.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
</div>
<p><a href="mcp48x2__dac_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdac__channel__t.html">dac_channel_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct for config values for each channel - this is only to be used as a nested struct within the <a class="el" href="structdac__config__t.html" title="Config struct for DAC.">dac_config_t</a> struct.  <a href="structdac__channel__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdac__config__t.html">dac_config_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Config struct for DAC.  <a href="structdac__config__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5bdce760d76b7797faa3d512ccb1b35e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#a5bdce760d76b7797faa3d512ccb1b35e">DAC_CHANNEL_A</a>&#160;&#160;&#160;true</td></tr>
<tr class="separator:a5bdce760d76b7797faa3d512ccb1b35e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa020bdd087f2d626d9a93456908f54e4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#aa020bdd087f2d626d9a93456908f54e4">DAC_CHANNEL_B</a>&#160;&#160;&#160;false</td></tr>
<tr class="separator:aa020bdd087f2d626d9a93456908f54e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a4baee670fe47b12488d09305e1f6d5ba"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#a4baee670fe47b12488d09305e1f6d5ba">model_num_t</a> { <b>mcp4802</b>
, <b>mcp4812</b>
, <b>mcp4822</b>
 }</td></tr>
<tr class="memdesc:a4baee670fe47b12488d09305e1f6d5ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumerated constants to select the DAC model number.  <a href="mcp48x2__dac_8h.html#a4baee670fe47b12488d09305e1f6d5ba">More...</a><br /></td></tr>
<tr class="separator:a4baee670fe47b12488d09305e1f6d5ba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aaf5962070b11ed66e257763c365ad321"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#aaf5962070b11ed66e257763c365ad321">init_dac</a> (<a class="el" href="structdac__config__t.html">dac_config_t</a> *p_config)</td></tr>
<tr class="memdesc:aaf5962070b11ed66e257763c365ad321"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialisation routine (run once at startup).  <a href="mcp48x2__dac_8h.html#aaf5962070b11ed66e257763c365ad321">More...</a><br /></td></tr>
<tr class="separator:aaf5962070b11ed66e257763c365ad321"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e5a30fe5a03338c88ef80b84f3098b7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#a8e5a30fe5a03338c88ef80b84f3098b7">dac_set_voltage</a> (bool channel_a, uint16_t millivolts)</td></tr>
<tr class="memdesc:a8e5a30fe5a03338c88ef80b84f3098b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a new millivolts value to be output on DAC (Along with config settings).  <a href="mcp48x2__dac_8h.html#a8e5a30fe5a03338c88ef80b84f3098b7">More...</a><br /></td></tr>
<tr class="separator:a8e5a30fe5a03338c88ef80b84f3098b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f072c8589330fc4221de05b4d2cf8f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#a9f072c8589330fc4221de05b4d2cf8f7">dac_set_voltage_12_bit</a> (bool channel_a, uint16_t millivolts, bool fractional)</td></tr>
<tr class="memdesc:a9f072c8589330fc4221de05b4d2cf8f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a new millivolts value to be output on DAC (Along with config settings).  <a href="mcp48x2__dac_8h.html#a9f072c8589330fc4221de05b4d2cf8f7">More...</a><br /></td></tr>
<tr class="separator:a9f072c8589330fc4221de05b4d2cf8f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7d4460badaeb5c1255a471604ee7823"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#ab7d4460badaeb5c1255a471604ee7823">dac_reconfigure</a> (void)</td></tr>
<tr class="memdesc:ab7d4460badaeb5c1255a471604ee7823"><td class="mdescLeft">&#160;</td><td class="mdescRight">Applies new config settings.  <a href="mcp48x2__dac_8h.html#ab7d4460badaeb5c1255a471604ee7823">More...</a><br /></td></tr>
<tr class="separator:ab7d4460badaeb5c1255a471604ee7823"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afd38e4b814863ec79d710ee2c3623adb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mcp48x2__dac_8h.html#afd38e4b814863ec79d710ee2c3623adb">pulse_latch</a> (void)</td></tr>
<tr class="memdesc:afd38e4b814863ec79d710ee2c3623adb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pulses LDAC pin low for a brief time (1uS).  <a href="mcp48x2__dac_8h.html#afd38e4b814863ec79d710ee2c3623adb">More...</a><br /></td></tr>
<tr class="separator:afd38e4b814863ec79d710ee2c3623adb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Driver for the MCP4812 10 bit DAC (digital to analog converter) chip. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>Copyright Â© 2022 by Jason Duffy.</dd></dl>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p >The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p >THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p><dl class="section author"><dt>Author</dt><dd>Jason Duffy </dd></dl>
<dl class="section date"><dt>Date</dt><dd>4th March 2022 </dd></dl>
<p >This file provides the basic low-level functionality for the MCP4812 10 bit DAC from Microchip. This driver currently only allows for a single DAC to be used, but this might be improved on at a later date. This driver was written using the datasheet for the Microchip MCP4812 chip, which can be found at the link below. </p><dl class="section see"><dt>See also</dt><dd><a href="https://ww1.microchip.com/downloads/en/DeviceDoc/20002249B.pdf">https://ww1.microchip.com/downloads/en/DeviceDoc/20002249B.pdf</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="mcp48x2__dac_8h_source.html">mcp48x2_dac.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a5bdce760d76b7797faa3d512ccb1b35e" name="a5bdce760d76b7797faa3d512ccb1b35e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5bdce760d76b7797faa3d512ccb1b35e">&#9670;&nbsp;</a></span>DAC_CHANNEL_A</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAC_CHANNEL_A&#160;&#160;&#160;true</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8h_source.html#l00044">44</a> of file <a class="el" href="mcp48x2__dac_8h_source.html">mcp48x2_dac.h</a>.</p>

</div>
</div>
<a id="aa020bdd087f2d626d9a93456908f54e4" name="aa020bdd087f2d626d9a93456908f54e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa020bdd087f2d626d9a93456908f54e4">&#9670;&nbsp;</a></span>DAC_CHANNEL_B</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAC_CHANNEL_B&#160;&#160;&#160;false</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8h_source.html#l00045">45</a> of file <a class="el" href="mcp48x2__dac_8h_source.html">mcp48x2_dac.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a4baee670fe47b12488d09305e1f6d5ba" name="a4baee670fe47b12488d09305e1f6d5ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4baee670fe47b12488d09305e1f6d5ba">&#9670;&nbsp;</a></span>model_num_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="mcp48x2__dac_8h.html#a4baee670fe47b12488d09305e1f6d5ba">model_num_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enumerated constants to select the DAC model number. </p>

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8h_source.html#l00051">51</a> of file <a class="el" href="mcp48x2__dac_8h_source.html">mcp48x2_dac.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   52</span>{</div>
<div class="line"><span class="lineno">   53</span>    mcp4802,</div>
<div class="line"><span class="lineno">   54</span>    mcp4812,</div>
<div class="line"><span class="lineno">   55</span>    mcp4822</div>
<div class="line"><span class="lineno">   56</span>} <a class="code hl_enumeration" href="mcp48x2__dac_8h.html#a4baee670fe47b12488d09305e1f6d5ba">model_num_t</a>;</div>
<div class="ttc" id="amcp48x2__dac_8h_html_a4baee670fe47b12488d09305e1f6d5ba"><div class="ttname"><a href="mcp48x2__dac_8h.html#a4baee670fe47b12488d09305e1f6d5ba">model_num_t</a></div><div class="ttdeci">model_num_t</div><div class="ttdoc">Enumerated constants to select the DAC model number.</div><div class="ttdef"><b>Definition:</b> <a href="mcp48x2__dac_8h_source.html#l00051">mcp48x2_dac.h:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aaf5962070b11ed66e257763c365ad321" name="aaf5962070b11ed66e257763c365ad321"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf5962070b11ed66e257763c365ad321">&#9670;&nbsp;</a></span>init_dac()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_dac </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdac__config__t.html">dac_config_t</a> *&#160;</td>
          <td class="paramname"><em>p_config</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialisation routine (run once at startup). </p>
<p >This function is to be called before using any other DAC functions. Instantiate the <a class="el" href="structdac__config__t.html" title="Config struct for DAC.">dac_config_t</a> object first then pass it's address into and call <a class="el" href="avr-peripheral-features_2timer-counter_2digital-clock_2example_2hd44780__lcd_8c.html#a7850604dcf83e9e426e095c50b22fb87" title="Initialisation routine (run once at startup).">init_lcd()</a> before using any other lcd functions. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_config</td><td>is a pointer to the <a class="el" href="structdac__config__t.html" title="Config struct for DAC.">dac_config_t</a> object. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8c_source.html#l00089">89</a> of file <a class="el" href="mcp48x2__dac_8c_source.html">mcp48x2_dac.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   90</span>{</div>
<div class="line"><span class="lineno">   91</span>    <span class="comment">// Copy config object pointer to a variable with file scope. </span></div>
<div class="line"><span class="lineno">   92</span>    p_config_global = p_config;</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>    <span class="comment">// Delay to allow power ramp up in device.</span></div>
<div class="line"><span class="lineno">   95</span>    _delay_ms(500);</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>    <span class="comment">// Initialise SPI comms. </span></div>
<div class="line"><span class="lineno">   98</span>    <a class="code hl_function" href="avr-peripheral-features_2spi_2atmega__spi_8c.html#a5217b7d219487d49ba5f23b16fcf26b1">init_spi</a>(lsb_first,</div>
<div class="line"><span class="lineno">   99</span>             controller,</div>
<div class="line"><span class="lineno">  100</span>             rising_edge,</div>
<div class="line"><span class="lineno">  101</span>             sample_leading_edge,</div>
<div class="line"><span class="lineno">  102</span>             cpu_clk_div_16,</div>
<div class="line"><span class="lineno">  103</span>             single_speed);</div>
<div class="line"><span class="lineno">  104</span> </div>
<div class="line"><span class="lineno">  105</span>    DAC_CTRL_DDR |= (1 &lt;&lt; DAC_CS); <span class="comment">// Set chip select as output.</span></div>
<div class="line"><span class="lineno">  106</span>    DAC_CTRL_PORT |= (1 &lt;&lt; DAC_CS); <span class="comment">// Set CS line high (not selected).</span></div>
<div class="line"><span class="lineno">  107</span>    DAC_CTRL_DDR |= (1 &lt;&lt; LDAC); <span class="comment">// Set LDAC line (latch) as output.</span></div>
<div class="line"><span class="lineno">  108</span>    DAC_CTRL_PORT |= (1 &lt;&lt; LDAC); <span class="comment">// Set LDAC high.</span></div>
<div class="line"><span class="lineno">  109</span> </div>
<div class="line"><span class="lineno">  110</span>    <span class="comment">// Save the value to bitshift millivolts value by. </span></div>
<div class="line"><span class="lineno">  111</span>    <span class="keywordflow">if</span> (p_config_global-&gt;model == mcp4802)</div>
<div class="line"><span class="lineno">  112</span>    {</div>
<div class="line"><span class="lineno">  113</span>      mv_resolution_shift = EIGHT_BIT_MV_OFFSET;</div>
<div class="line"><span class="lineno">  114</span>      level_resolution_shift = EIGHT_BIT_LEVEL_OFFSET;</div>
<div class="line"><span class="lineno">  115</span>    }</div>
<div class="line"><span class="lineno">  116</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p_config_global-&gt;model == mcp4812)</div>
<div class="line"><span class="lineno">  117</span>    {</div>
<div class="line"><span class="lineno">  118</span>      mv_resolution_shift = TEN_BIT_MV_OFFSET;</div>
<div class="line"><span class="lineno">  119</span>      level_resolution_shift = TEN_BIT_LEVEL_OFFSET;</div>
<div class="line"><span class="lineno">  120</span>    }</div>
<div class="line"><span class="lineno">  121</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  122</span>    {</div>
<div class="line"><span class="lineno">  123</span>      mv_resolution_shift = TWELVE_BIT_MV_OFFSET;</div>
<div class="line"><span class="lineno">  124</span>      level_resolution_shift = TWELVE_BIT_LEVEL_OFFSET;</div>
<div class="line"><span class="lineno">  125</span>    }  </div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>    <span class="comment">// Establish latching settings</span></div>
<div class="line"><span class="lineno">  128</span>    <span class="keywordflow">if</span> (!p_config_global-&gt;sync_manually)</div>
<div class="line"><span class="lineno">  129</span>    {</div>
<div class="line"><span class="lineno">  130</span>      DAC_CTRL_PORT &amp;= ~(1 &lt;&lt; LDAC);</div>
<div class="line"><span class="lineno">  131</span>    }</div>
<div class="line"><span class="lineno">  132</span> </div>
<div class="line"><span class="lineno">  133</span>    <span class="comment">// Send new values to DAC</span></div>
<div class="line"><span class="lineno">  134</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#ab7d4460badaeb5c1255a471604ee7823">dac_reconfigure</a>();</div>
<div class="line"><span class="lineno">  135</span>}</div>
<div class="ttc" id="aavr-peripheral-features_2spi_2atmega__spi_8c_html_a5217b7d219487d49ba5f23b16fcf26b1"><div class="ttname"><a href="avr-peripheral-features_2spi_2atmega__spi_8c.html#a5217b7d219487d49ba5f23b16fcf26b1">init_spi</a></div><div class="ttdeci">void init_spi(spi_transfer_mode_t transfer_mode, spi_control_mode_t control_mode, spi_polarity_mode_t polarity_mode, spi_phase_mode_t phase_mode, spi_clk_rate_t clk_rate, spi_dbl_clk_mode_t dbl_clock)</div><div class="ttdoc">Initialisation routine to set up SPI comms.</div><div class="ttdef"><b>Definition:</b> <a href="avr-peripheral-features_2spi_2atmega__spi_8c_source.html#l00053">atmega_spi.c:53</a></div></div>
<div class="ttc" id="amcp48x2__dac_8c_html_ab7d4460badaeb5c1255a471604ee7823"><div class="ttname"><a href="mcp48x2__dac_8c.html#ab7d4460badaeb5c1255a471604ee7823">dac_reconfigure</a></div><div class="ttdeci">void dac_reconfigure(void)</div><div class="ttdoc">Applies new config settings.</div><div class="ttdef"><b>Definition:</b> <a href="mcp48x2__dac_8c_source.html#l00240">mcp48x2_dac.c:240</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e5a30fe5a03338c88ef80b84f3098b7" name="a8e5a30fe5a03338c88ef80b84f3098b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e5a30fe5a03338c88ef80b84f3098b7">&#9670;&nbsp;</a></span>dac_set_voltage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dac_set_voltage </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>channel_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>millivolts</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a new millivolts value to be output on DAC (Along with config settings). </p>
<p >For 8 or 10 bit models only. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel_a</td><td>true = Channel A, false = Channel B. </td></tr>
    <tr><td class="paramname">millivolts</td><td>mV value to be output by DAC. Ensure that this value doesn't exceed the maxixum for the DAC model and gain setting. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8c_source.html#l00145">145</a> of file <a class="el" href="mcp48x2__dac_8c_source.html">mcp48x2_dac.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  146</span>{</div>
<div class="line"><span class="lineno">  147</span>    <span class="comment">// Manipulate mv value to suit register size of chip and gain setting.</span></div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordflow">if</span> (channel_a)</div>
<div class="line"><span class="lineno">  149</span>    {</div>
<div class="line"><span class="lineno">  150</span>        <span class="keywordflow">if</span> (p_config_global-&gt;channel_a.gain_low)</div>
<div class="line"><span class="lineno">  151</span>        {   </div>
<div class="line"><span class="lineno">  152</span>            p_config_global-&gt;channel_a.level =</div>
<div class="line"><span class="lineno">  153</span>                                (millivolts &gt;&gt; mv_resolution_shift);</div>
<div class="line"><span class="lineno">  154</span>        }</div>
<div class="line"><span class="lineno">  155</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  156</span>        {</div>
<div class="line"><span class="lineno">  157</span>            p_config_global-&gt;channel_a.level =</div>
<div class="line"><span class="lineno">  158</span>                                (millivolts &gt;&gt; (mv_resolution_shift + 1));</div>
<div class="line"><span class="lineno">  159</span>        }</div>
<div class="line"><span class="lineno">  160</span>    }</div>
<div class="line"><span class="lineno">  161</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  162</span>    {</div>
<div class="line"><span class="lineno">  163</span>        <span class="keywordflow">if</span> (p_config_global-&gt;channel_b.gain_low)</div>
<div class="line"><span class="lineno">  164</span>        {</div>
<div class="line"><span class="lineno">  165</span>            p_config_global-&gt;channel_b.level =</div>
<div class="line"><span class="lineno">  166</span>                                (millivolts &gt;&gt; mv_resolution_shift);</div>
<div class="line"><span class="lineno">  167</span>        }</div>
<div class="line"><span class="lineno">  168</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  169</span>        {</div>
<div class="line"><span class="lineno">  170</span>            p_config_global-&gt;channel_b.level =</div>
<div class="line"><span class="lineno">  171</span>                                (millivolts &gt;&gt; (mv_resolution_shift + 1));</div>
<div class="line"><span class="lineno">  172</span>        }</div>
<div class="line"><span class="lineno">  173</span>    }</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>    <span class="comment">// Send new values to DAC</span></div>
<div class="line"><span class="lineno">  176</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#ab7d4460badaeb5c1255a471604ee7823">dac_reconfigure</a>();</div>
<div class="line"><span class="lineno">  177</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a9f072c8589330fc4221de05b4d2cf8f7" name="a9f072c8589330fc4221de05b4d2cf8f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f072c8589330fc4221de05b4d2cf8f7">&#9670;&nbsp;</a></span>dac_set_voltage_12_bit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dac_set_voltage_12_bit </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>channel_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>millivolts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fractional</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a new millivolts value to be output on DAC (Along with config settings). </p>
<p >For 12 bit models only. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel_a</td><td>true = Channel A, false = Channel B. </td></tr>
    <tr><td class="paramname">millivolts</td><td>mV value to be output by DAC. Ensure that this value doesn't exceed the maxixum for the DAC model and gain setting. </td></tr>
    <tr><td class="paramname">fractional</td><td>true = millivolts value has 0.5mV added to it. Only to be used when gain_low is true. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8c_source.html#l00189">189</a> of file <a class="el" href="mcp48x2__dac_8c_source.html">mcp48x2_dac.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  192</span>{</div>
<div class="line"><span class="lineno">  193</span>    <span class="keywordflow">if</span> (channel_a)</div>
<div class="line"><span class="lineno">  194</span>    {</div>
<div class="line"><span class="lineno">  195</span>        <span class="keywordflow">if</span>(p_config_global-&gt;channel_a.gain_low)</div>
<div class="line"><span class="lineno">  196</span>        {</div>
<div class="line"><span class="lineno">  197</span>            p_config_global-&gt;channel_a.level =</div>
<div class="line"><span class="lineno">  198</span>                                (millivolts &lt;&lt; (TWELVE_BIT_MV_OFFSET + 1));</div>
<div class="line"><span class="lineno">  199</span>            <span class="comment">// Add the 0.5mV value if required. </span></div>
<div class="line"><span class="lineno">  200</span>            <span class="keywordflow">if</span> (fractional == <span class="keyword">true</span>)</div>
<div class="line"><span class="lineno">  201</span>            {</div>
<div class="line"><span class="lineno">  202</span>                p_config_global-&gt;channel_a.level += 1;</div>
<div class="line"><span class="lineno">  203</span>            }</div>
<div class="line"><span class="lineno">  204</span>        }</div>
<div class="line"><span class="lineno">  205</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  206</span>        {</div>
<div class="line"><span class="lineno">  207</span>            p_config_global-&gt;channel_a.level =</div>
<div class="line"><span class="lineno">  208</span>                                (millivolts &lt;&lt; TWELVE_BIT_MV_OFFSET);</div>
<div class="line"><span class="lineno">  209</span>        }</div>
<div class="line"><span class="lineno">  210</span>    }</div>
<div class="line"><span class="lineno">  211</span>    <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  212</span>    {</div>
<div class="line"><span class="lineno">  213</span>        <span class="keywordflow">if</span>(p_config_global-&gt;channel_b.gain_low)</div>
<div class="line"><span class="lineno">  214</span>        {</div>
<div class="line"><span class="lineno">  215</span>            p_config_global-&gt;channel_b.level =</div>
<div class="line"><span class="lineno">  216</span>                                (millivolts &lt;&lt; (TWELVE_BIT_MV_OFFSET + 1));</div>
<div class="line"><span class="lineno">  217</span>            <span class="comment">// Add the 0.5mV value if required. </span></div>
<div class="line"><span class="lineno">  218</span>            <span class="keywordflow">if</span> (fractional == <span class="keyword">true</span>)</div>
<div class="line"><span class="lineno">  219</span>            {</div>
<div class="line"><span class="lineno">  220</span>                p_config_global-&gt;channel_b.level += 1;</div>
<div class="line"><span class="lineno">  221</span>            }</div>
<div class="line"><span class="lineno">  222</span>        }</div>
<div class="line"><span class="lineno">  223</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  224</span>        {</div>
<div class="line"><span class="lineno">  225</span>            p_config_global-&gt;channel_b.level =</div>
<div class="line"><span class="lineno">  226</span>                                (millivolts &lt;&lt; TWELVE_BIT_MV_OFFSET);</div>
<div class="line"><span class="lineno">  227</span>        }</div>
<div class="line"><span class="lineno">  228</span>    }</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>    <span class="comment">// Send new values to DAC</span></div>
<div class="line"><span class="lineno">  231</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#ab7d4460badaeb5c1255a471604ee7823">dac_reconfigure</a>();</div>
<div class="line"><span class="lineno">  232</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab7d4460badaeb5c1255a471604ee7823" name="ab7d4460badaeb5c1255a471604ee7823"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7d4460badaeb5c1255a471604ee7823">&#9670;&nbsp;</a></span>dac_reconfigure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dac_reconfigure </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Applies new config settings. </p>
<p >This function takes updated config settings for both channels of DAC, then re-sends data so that the new settings take effect. </p>

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8c_source.html#l00240">240</a> of file <a class="el" href="mcp48x2__dac_8c_source.html">mcp48x2_dac.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  241</span>{</div>
<div class="line"><span class="lineno">  242</span>    uint16_t channel_a_data = 0;</div>
<div class="line"><span class="lineno">  243</span>    uint16_t channel_b_data = 0;</div>
<div class="line"><span class="lineno">  244</span> </div>
<div class="line"><span class="lineno">  245</span>    <span class="comment">// Set up config bits in 16bit word to be sent. </span></div>
<div class="line"><span class="lineno">  246</span>    channel_a_data &amp;= ~(1 &lt;&lt; CHANNEL_BIT); <span class="comment">// Clear channel bit (Channel A).</span></div>
<div class="line"><span class="lineno">  247</span>    channel_a_data |= (p_config_global-&gt;channel_a.gain_low &lt;&lt; GAIN_BIT);</div>
<div class="line"><span class="lineno">  248</span>    channel_a_data |= (p_config_global-&gt;channel_a.active &lt;&lt; SHUTDOWN_BIT);</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>    channel_b_data |= (1 &lt;&lt; CHANNEL_BIT); <span class="comment">// Set channel bit (Channel B).</span></div>
<div class="line"><span class="lineno">  251</span>    channel_b_data |= (p_config_global-&gt;channel_b.gain_low &lt;&lt; GAIN_BIT);</div>
<div class="line"><span class="lineno">  252</span>    channel_b_data |= (p_config_global-&gt;channel_b.active &lt;&lt; SHUTDOWN_BIT);</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>    <span class="comment">// Shift level into correct place for chip and OR it into our 16bit word.</span></div>
<div class="line"><span class="lineno">  255</span>    channel_a_data |=</div>
<div class="line"><span class="lineno">  256</span>                (p_config_global-&gt;channel_a.level &lt;&lt; level_resolution_shift);</div>
<div class="line"><span class="lineno">  257</span> </div>
<div class="line"><span class="lineno">  258</span>    channel_b_data |=</div>
<div class="line"><span class="lineno">  259</span>                (p_config_global-&gt;channel_b.level &lt;&lt; level_resolution_shift);</div>
<div class="line"><span class="lineno">  260</span>                </div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>    <span class="comment">// Send data for channel A to DAC over SPI. </span></div>
<div class="line"><span class="lineno">  263</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#a19f76a44569088d532ecaa6ea938be14">chip_select</a>();</div>
<div class="line"><span class="lineno">  264</span>    <a class="code hl_function" href="avr-peripheral-features_2spi_2atmega__spi_8c.html#ae48f6a6f69805dfd10b3ac13c37f8428">spi_trade_word</a>(channel_a_data);</div>
<div class="line"><span class="lineno">  265</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#abcfcb3f6bdd45f73f27edc2ea06c1d99">chip_deselect</a>();</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>    <span class="comment">// Send data for channel B to DAC over SPI.</span></div>
<div class="line"><span class="lineno">  268</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#a19f76a44569088d532ecaa6ea938be14">chip_select</a>();</div>
<div class="line"><span class="lineno">  269</span>    <a class="code hl_function" href="avr-peripheral-features_2spi_2atmega__spi_8c.html#ae48f6a6f69805dfd10b3ac13c37f8428">spi_trade_word</a>(channel_b_data);</div>
<div class="line"><span class="lineno">  270</span>    <a class="code hl_function" href="mcp48x2__dac_8c.html#abcfcb3f6bdd45f73f27edc2ea06c1d99">chip_deselect</a>();</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>    <span class="comment">// If sync_manually is set to false, pulse LDAC to update values. </span></div>
<div class="line"><span class="lineno">  273</span>    <span class="keywordflow">if</span> (!p_config_global-&gt;sync_manually)</div>
<div class="line"><span class="lineno">  274</span>    {</div>
<div class="line"><span class="lineno">  275</span>        <a class="code hl_function" href="mcp48x2__dac_8c.html#afd38e4b814863ec79d710ee2c3623adb">pulse_latch</a>();</div>
<div class="line"><span class="lineno">  276</span>    }</div>
<div class="line"><span class="lineno">  277</span>}</div>
<div class="ttc" id="aavr-peripheral-features_2spi_2atmega__spi_8c_html_ae48f6a6f69805dfd10b3ac13c37f8428"><div class="ttname"><a href="avr-peripheral-features_2spi_2atmega__spi_8c.html#ae48f6a6f69805dfd10b3ac13c37f8428">spi_trade_word</a></div><div class="ttdeci">uint16_t spi_trade_word(uint16_t data)</div><div class="ttdoc">Sends out a 16bit word of data over spi (in two bytes) and returns the byte it receives.</div><div class="ttdef"><b>Definition:</b> <a href="avr-peripheral-features_2spi_2atmega__spi_8c_source.html#l00098">atmega_spi.c:98</a></div></div>
<div class="ttc" id="amcp48x2__dac_8c_html_a19f76a44569088d532ecaa6ea938be14"><div class="ttname"><a href="mcp48x2__dac_8c.html#a19f76a44569088d532ecaa6ea938be14">chip_select</a></div><div class="ttdeci">void chip_select(void)</div><div class="ttdoc">Private helper function - pulls CS line (Chip Select) low in order to begin SPI communication with DA...</div><div class="ttdef"><b>Definition:</b> <a href="mcp48x2__dac_8c_source.html#l00302">mcp48x2_dac.c:302</a></div></div>
<div class="ttc" id="amcp48x2__dac_8c_html_abcfcb3f6bdd45f73f27edc2ea06c1d99"><div class="ttname"><a href="mcp48x2__dac_8c.html#abcfcb3f6bdd45f73f27edc2ea06c1d99">chip_deselect</a></div><div class="ttdeci">void chip_deselect(void)</div><div class="ttdoc">Private helper function - pulls CS line (Chip Select) high to signal the end of SPI communication wit...</div><div class="ttdef"><b>Definition:</b> <a href="mcp48x2__dac_8c_source.html#l00311">mcp48x2_dac.c:311</a></div></div>
<div class="ttc" id="amcp48x2__dac_8c_html_afd38e4b814863ec79d710ee2c3623adb"><div class="ttname"><a href="mcp48x2__dac_8c.html#afd38e4b814863ec79d710ee2c3623adb">pulse_latch</a></div><div class="ttdeci">void pulse_latch(void)</div><div class="ttdoc">Pulses LDAC pin low for a brief time (1uS).</div><div class="ttdef"><b>Definition:</b> <a href="mcp48x2__dac_8c_source.html#l00286">mcp48x2_dac.c:286</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afd38e4b814863ec79d710ee2c3623adb" name="afd38e4b814863ec79d710ee2c3623adb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afd38e4b814863ec79d710ee2c3623adb">&#9670;&nbsp;</a></span>pulse_latch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pulse_latch </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pulses LDAC pin low for a brief time (1uS). </p>
<p >When sync_manually is true, call this function to latch both config settings and new voltage value into both channels of DAC simultaneously. </p>

<p class="definition">Definition at line <a class="el" href="mcp48x2__dac_8c_source.html#l00286">286</a> of file <a class="el" href="mcp48x2__dac_8c_source.html">mcp48x2_dac.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  287</span>{</div>
<div class="line"><span class="lineno">  288</span>    DAC_CTRL_PORT &amp;= ~(1 &lt;&lt; LDAC);</div>
<div class="line"><span class="lineno">  289</span>    _delay_us(1);</div>
<div class="line"><span class="lineno">  290</span>    DAC_CTRL_PORT |= (1 &lt;&lt; LDAC);</div>
<div class="line"><span class="lineno">  291</span>}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_9c069a2336cfd446496c25258e848904.html">content</a></li><li class="navelem"><a class="el" href="dir_d21582d1a0e016fb5573a1a04428266d.html">modules</a></li><li class="navelem"><a class="el" href="dir_19632f2a80484ef9afe3012ab7dd8955.html">data-converters</a></li><li class="navelem"><a class="el" href="dir_340990b44e01d627ee6fa342ae045fcd.html">mcp48x2_dac</a></li><li class="navelem"><a class="el" href="dir_f0fb721cea2e057a74d5452615af3919.html">example</a></li><li class="navelem"><a class="el" href="mcp48x2__dac_8h.html">mcp48x2_dac.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
